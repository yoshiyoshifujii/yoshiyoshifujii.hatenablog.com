---
Title: 分散システムにちょっとだけ入門したのでメモっておく
Category:
- 分散システム
Date: 2019-04-25T17:24:46+09:00
URL: https://yoshiyoshifujii.hatenablog.com/entry/2019/04/25/172446
EditURL: https://blog.hatena.ne.jp/yoshiyoshifujii/yoshiyoshifujii.hatenablog.com/atom/entry/17680117127077013214
---

Akka Clusterを運用していくとなると、社内でこの資料を読んで理解しておきたいねって話があった。

<iframe src="//www.slideshare.net/slideshow/embed_code/key/FzancdlGCuH1TP" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/TanUkkii/akka-cluster-66880662" title="Akka Clusterの耐障害設計" target="_blank">Akka Clusterの耐障害設計</a> </strong> from <strong><a href="https://www.slideshare.net/TanUkkii" target="_blank">TanUkkii</a></strong> </div>

で、Scala関西 Summit 2016の資料じゃーん、おやもしかして動画あるんじゃね?って探したらあった。

<iframe width="560" height="315" frameborder="0" allowfullscreen="" src="//www.youtube.com/embed/Eszd1GEcOjE"></iframe><br><a href="https://youtube.com/watch?v=Eszd1GEcOjE">【Scala関西Summit2016】Akka Clusterのネットワーク分断耐性設計</a>

で、こちらを拝聴したところ、すごい世界が広がってたので、そこからのめりこむように、沼な世界を調べてったあたりのことをメモっておく。

沼の入口は↓

<!-- more -->

# Akka Clusterの耐障害設計-スピーカーノート

冒頭の資料、動画のスピーカーノートは↓。

[https://github.com/TanUkkii007/blog/blob/master/akka_cluster_resilience.md:embed:cite]

動画で聞きとれなかったところは、スピーカーノートで再度確認すると、さらに深い知見が伺える。

冒頭でお話されてた、Akka Clusterの適用領域に関する考察とかすごい。

> Akka Clusterはmulti-tierサービスのうちfirst-tier、つまりクライアントとのインタラクションを伴いダイナミックにスケールすることが求められる領域に適用できます。

多層アーキテクチャのクライアント側に一番近い層を動的にスケールすることが求められる場合に、かなり良いと理解した。

> soft-stateによる高い可用性と結果整合性による高いスケーラビリティを主軸にするアプローチをBASE(Basically Available, Soft state, Eventually consistent)といいます
> Akka Clusterをどこで使えば効果的かという問に答えると、BASEなシステムを構築するときだと私は考えています。

ということで、Akka Clusterは、クライアントに近いところで、BASEなシステムを構築するのに向いているとのこと。ふむふむ。

# 故障の種類

[f:id:yoshiyoshifujii:20190425091703p:plain]

故障には4つの分類があるとのこと。

で、以下の書籍から引用されている様子…。

[asin:B008R61LBG:detail]

直訳すると、「信頼性が高く安全な分散プログラミングの紹介」ということで、分散プログラミングについて書かれた書籍ですね。

とりあえず、積んでおくか…


# split brain問題

[f:id:yoshiyoshifujii:20190425155652p:plain]

分散システムを組んでいると、リーダーがメンバーの状態を正しく把握することができない(死んでるよーって言ってるけど、本当は死んでないってことがあり得る、たとえばネットワークが瞬断されたあとで復活するとか)ために起こり得る問題とのこと。

# split brain resolver

split brain問題の解決策。

Lightbend社が作った仕様は↓。

[https://developer.lightbend.com/docs/akka-commercial-addons/current/split-brain-resolver.html:embed:cite]

安田さんがその仕様を見たりして作られたやつが↓。

[https://github.com/TanUkkii007/akka-cluster-custom-downing:embed:cite]

# FLP Impossibility

FLP不可能性。

論文が↓

[http://groups.csail.mit.edu/tds/papers/Lynch/jacm85.pdf]

「完璧なsplit brain resolverのストラテジはない」ということが証明されているとのこと。

以下のスライドでも紹介されている。論文を解説されている気配…すごい…

<iframe src="//www.slideshare.net/slideshow/embed_code/key/DOtH1TTpRuuj6N" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/ShingoOmura/ss-103946354" title="分散システムの限界について知ろう" target="_blank">分散システムの限界について知ろう</a> </strong> from <strong><a href="https://www.slideshare.net/ShingoOmura" target="_blank">Shingo Omura</a></strong> </div>

また、大村さんのスライドの中から引用されていたスライドが以下↓

<iframe src="//www.slideshare.net/slideshow/embed_code/key/KLwZpekGWVLuEE" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/kumagi/ss-81368169" title="本当は恐ろしい分散システムの話" target="_blank">本当は恐ろしい分散システムの話</a> </strong> from <strong><a href="https://www.slideshare.net/kumagi" target="_blank">Kumazaki Hiroki</a></strong> </div>

<iframe src="//www.slideshare.net/slideshow/embed_code/key/2ZMVmsY8BbuJ3o" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/kumagi/ss-78765920" title="分散システムについて語らせてくれ" target="_blank">分散システムについて語らせてくれ</a> </strong> from <strong><a href="https://www.slideshare.net/kumagi" target="_blank">Kumazaki Hiroki</a></strong> </div>

このあたりもすごい分かりやすかった。

# CAP定理の見直し

[f:id:yoshiyoshifujii:20190425171820p:plain]

大村さんの資料の中であった。

以下に解説記事とかがある。

[https://www.infoq.com/jp/articles/cap-twelve-years-later-how-the-rules-have-changed:embed:cite]


あと、以下は良書とのこと。

[asin:1449373321:detail]

紹介されている記事もあった。

[https://takuti.me/note/designing-data-intensive-applications/:embed:cite]


# まとめ

ざーっとソースを広げていくと、いっぱい広がりました。

とりあえず、ちょっとずつやっていこう…

以上です。
